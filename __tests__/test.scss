@import "true";
@import "./rhythm";

$global-baseline: 0.112061 !global;
$font-map-1: (
  font-size: 24px,
  line-height: 5
);
$font-map-2: (
  font-size: 16px,
  line-height: 3
);
$font-map-3: (
  font-size: 17px,
  line-height: 3,
  baseline: 0.112061
);
$font-map-4: (
  font-size: 17px,
  line-height: 3
);
$font-map-5: (
  font-size: 12px,
  line-height: 2
);

@include test-module("Test validation functions:") {
  @include test("_validate-font-size") {
    @include assert-equal(_validate-font-size(16px), 16px);
  }

  @include test("_validate-rhythm-grids") {
    @include assert-equal(_validate-rhythm-grids(8), 8);
  }

  @include test("_validate-line-height") {
    @include assert-equal(_validate-line-height(8), 8);
  }

  @include test("_validate-baseline") {
    @include assert-equal(_validate-baseline(0.112061), 0.112061);
  }

  @include test("_validate-property") {
    @include assert-equal(_validate-property(null, margin-top), margin-top);
    @include assert-equal(_validate-property(margin-top, margin-top), margin-top);
  }
}

@include test-module("Test helper functions:") {
  @include test("_first") {
    @include assert-equal(_first((1, 2, 3)), 1);
  }

  @include test("_rest") {
    @include assert-equal(_rest((1, 2, 3)), (2 3));
  }

  @include test("_is-integer") {
    @include assert-equal(_is-integer(0), true);
    @include assert-equal(_is-integer(10), true);
    @include assert-equal(_is-integer(-10), true);
    @include assert-equal(_is-integer(10px), false);
    @include assert-equal(_is-integer("10px"), false);
  }

  @include test("_calc-baseline-from-bottom") {
    @include assert-equal(_calc-baseline-from-bottom($font-map-1), 11px);
  }

  @include test("_calc-baseline-from-top") {
    @include assert-equal(_calc-baseline-from-top($font-map-1), 29px);
  }

  @include test("_calc-offset") {
    @include assert-equal(_calc-offset(20px, 0), 20px);
    @include assert-equal(_calc-offset(20px, 1px), 21px);
    @include assert-equal(_calc-offset(20px, -1px), 19px);

    // @include assert-equal(_calc-offset(2rem, -1px), calc(2rem - 1px));
  }
}

@include test-module("Test functions:") {
  @include test("rhythm") {
    @include assert-equal(rhythm(5), 40px);
    @include assert-equal(rhythm(5, -1px), 39px);
    @include assert-equal(rhythm(5, 1px), 41px);
  }

  @include test("top-rhythm") {
    @include assert-equal(top-rhythm($font-map-3, 3), 5px);
    @include assert-equal(top-rhythm($font-map-4, 3), 5px);
    @include assert-equal(top-rhythm($font-map-4, 3, -1px), 4px);
    @include assert-equal(top-rhythm($font-map-4, 3, 1px), 6px);
    @include assert-equal(top-rhythm($font-map-4, 0), -19px);
  }

  @include test("bottom-rhythm") {
    @include assert-equal(bottom-rhythm($font-map-3, 3), 19px);
    @include assert-equal(bottom-rhythm($font-map-4, 3), 19px);
    @include assert-equal(bottom-rhythm($font-map-4, 3, -1px), 18px);
    @include assert-equal(bottom-rhythm($font-map-4, 3, 1px), 20px);
    @include assert-equal(bottom-rhythm($font-map-4, 0), -5px);
  }

  @include test("mid-rhythm") {
    @include assert-equal(mid-rhythm($font-map-3, $font-map-5, 3), 6px);
    @include assert-equal(mid-rhythm($font-map-3, $font-map-5, 3, -1px), 5px);
    @include assert-equal(mid-rhythm($font-map-3, $font-map-5, 3, 1px), 7px);
  }
}

@include test-module("Test mixins:") {
  @include test("font") {
    @include assert {
      @include output {
        @include font(
          (
            font-size: 24px,
            line-height: 5,
            font-weight: 700
          )
        );
      }

      @include expect {
        line-height: 40px;
        font-size: 24px;
        font-weight: 700;
      }
    }

    @include assert {
      @include output {
        @include font(
          $font-map-3,
          (
            margin-top: 3,
            margin-bottom: 3
          )
        );
      }

      @include expect {
        line-height: 24px;
        font-size: 17px;
        margin-top: 5px;
        margin-bottom: 19px;
      }
    }

    @include assert {
      @include output {
        @include font(
          $font-map-3,
          (
            margin-top: $font-map-5 3,
            margin-bottom: $font-map-5 3
          )
        );
      }

      @include expect {
        line-height: 24px;
        font-size: 17px;
        margin-top: 2px;
        margin-bottom: 6px;
      }
    }
  }
}
